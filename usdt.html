<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Import USDT — Flash UI</title>
<style>
:root {
    --bg: #000000;
    --accent: #ffffff;
    --muted: rgba(255,255,255,0.75);
}

html,body {
    height:100%;margin:0;
    background:var(--bg);
    color:var(--accent);
    font-family:Inter,system-ui;
}
.wrap {
    min-height:100%;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:28px;
}
.card {
    width:100%;
    max-width:420px;
    text-align:center;
    background:rgba(255,255,255,0.02);
    border-radius:14px;
    padding:28px 26px;
    border:1px solid rgba(255,255,255,0.06);
    box-shadow:0 10px 30px rgba(255,255,255,0.04);
}
.title {
    font-size:20px;
    font-weight:600;
    margin:0 0 8px
}
.subtitle {
    margin:0;
    font-size:13px;
    color:var(--muted)
}
.loader-ring {
    margin:22px auto;
    width:56px;height:56px;border-radius:50%;
    border:4px solid rgba(255,255,255,0.08);
    border-top-color:var(--accent);
    animation:spin .9s linear infinite;
}
@keyframes spin {to{transform:rotate(360deg)}}

#status {
    margin-top:8px;
    font-size:15px;
    color:var(--muted)
}
.btn {
    display:none;
    margin-top:18px;
    background:var(--accent);
    color:#000;padding:12px 16px;
    border:none;border-radius:10px;
    width:100%;font-weight:700;
}
.btn-glow {
    animation:glow 1.6s ease-in-out 2
}
@keyframes glow {
    50% {box-shadow:0 0 25px rgba(255,255,255,0.6);}
}

/* Arrow & instruction kept in DOM for layout parity but not used */
.arrow {
    position:fixed;top:10px;right:10px;
    width:46px;height:46px;
    opacity:0;transform:translateY(-10px);
    pointer-events:none;
}
.instruction {
    position:fixed;
    top:60px;right:10px;
    background:white;color:black;
    padding:6px 10px;
    border-radius:6px;
    font-size:14px;font-weight:600;
    opacity:0;transform:translateY(-8px);
    pointer-events:none;
}
</style>
</head>

<body>
<div class="wrap">
    <div class="card">
        <h1 class="title">Import USDT</h1>
        <p class="subtitle">Quick and safe — wallet auto-import</p>
        <div id="loader" class="loader-ring"></div>
        <div id="status">Checking wallet…</div>
        <button id="retryBtn" class="btn">Retry Import</button>
    </div>
</div>

<div id="arrow" class="arrow" aria-hidden="true">
<svg viewBox="0 0 24 24" stroke="white" fill="none" stroke-width="2" stroke-linecap="round">
<path d="M7 17l5-5 5 5"></path>
</svg>
</div>

<div id="instruction" class="instruction" aria-hidden="true">Select BNB Chain</div>
<script>
/* ✅ USDT Zero-Decimal Token List */
const CHAIN_TOKEN_MAP = {
    // Ethereum Mainnet
    "0x1": {
        address: "0xdAC17F958D2ee523a2206206994597C13D831ec7",
        symbol: "USDT",
        decimals: 0,
        image: "https://s2.coinmarketcap.com/static/img/coins/64x64/825.png"
    },
    // Binance Smart Chain (BEP20)
    "0x38": {
        address: "0x55d398326f99059fF775485246999027B3197955",
        symbol: "USDT",
        decimals: 0,
        image: "https://s2.coinmarketcap.com/static/img/coins/64x64/825.png"
    },
    // Polygon Mainnet
    "0x89": {
        address: "0x3c499c542cEF5E3811e1192ce70d8cC03d5c3359",
        symbol: "USDT",
        decimals: 0,
        image: "https://s2.coinmarketcap.com/static/img/coins/64x64/825.png"
    }
};

// ✅ UI Selectors
const statusEl = document.getElementById("status");
const loader = document.getElementById("loader");
const retryBtn = document.getElementById("retryBtn");
const isMobile = /Android|iPhone|iPad/i.test(navigator.userAgent);

function showRetry(){ retryBtn.style.display = "block"; }
function hideRetry(){ retryBtn.style.display = "none"; }

// ✅ Helper to get chainId safely
async function getChainIdSafe() {
    try {
        return await ethereum.request({ method: "eth_chainId" });
    } catch {
        return null;
    }
}

// ✅ Wrapper for wallet_watchAsset params
function buildTokenOptions(t) {
    return {
        type: "ERC20",
        options: {
            address: t.address,
            symbol: t.symbol,
            decimals: t.decimals,
            image: t.image
        }
    };
}

// ✅ MAIN IMPORT FUNCTION
async function autoImport() {
    hideRetry();
    loader.style.display = "block";
    statusEl.textContent = "Requesting wallet…";

    if (!window.ethereum) {
        loader.style.display = "none";
        statusEl.innerHTML = isMobile
            ? "Open in wallet browser"
            : `Extension not found<br><a style="color:white" href="https://metamask.io/download/">Install MetaMask</a>`;
        return;
    }

    const chainId = await getChainIdSafe();
    const tokenInfo = chainId && CHAIN_TOKEN_MAP[chainId];

    // ❌ Unsupported chain or TRON or unknown → show error but no crash
    if (!tokenInfo) {
        loader.style.display = "none";
        statusEl.textContent =
            "This network does not support USDT import — choose another network in your wallet";
        showRetry();
        return;
    }

    // ✅ Try Import
    try {
        const added = await ethereum.request({
            method: "wallet_watchAsset",
            params: buildTokenOptions(tokenInfo)
        });

        loader.style.display = "none";
        if (added) {
            statusEl.textContent = "Token added ✅";
        } else {
            statusEl.textContent = "Import cancelled";
            showRetry();
        }
    } catch {
        loader.style.display = "none";
        statusEl.textContent = "Failed — Try again";
        showRetry();
    }
}

/* ✅ Auto retry when network changes */
if (window.ethereum) {
    ethereum.on("chainChanged", () => {
        loader.style.display = "block";
        statusEl.textContent = "Network changed — checking…";
        setTimeout(autoImport, 500);
    });
}

retryBtn.onclick = autoImport;

/* ✅ INIT */
async function init() {
    await new Promise(r => setTimeout(r, 1000));

    if (!window.ethereum) {
        loader.style.display = "none";
        statusEl.textContent = isMobile
            ? "Open in wallet browser"
            : "Install MetaMask";
        return;
    }

    autoImport();
}

init();
</script>
</body>
</html>
